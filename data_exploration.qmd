---
title: "Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"
subtitle: "ÙÙ‡Ù… Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„ØªÙˆÙ†Ø³ÙŠØ©"
---

## ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

Ø£ÙˆÙ„Ø§Ù‹ØŒ Ù†Ù‚ÙˆÙ… Ø¨ØªØ­Ù…ÙŠÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© ÙˆØ§Ø³ØªÙƒØ´Ø§Ù Ø¨Ù†ÙŠØªÙ‡Ø§.

```{r}
#| label: load-data
#| message: false
#| warning: false

# ØªØ¹ÙŠÙŠÙ† Ù…Ø³Ø§Ø± Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø²Ù…
.libPaths(Sys.getenv("R_LIBS_USER"))
library(tidyverse)
library(knitr)
library(kableExtra)

# ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
source("R/load_data.R")
```

## Ø¨Ù†ÙŠØ© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

ØªØ­ØªÙˆÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø­ÙˆÙ„ Ù†Ø³Ø¨ Ù†Ø¬Ø§Ø­ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° Ø¹Ø¨Ø± Ø§Ù„Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„ØªÙˆÙ†Ø³ÙŠØ©.

```{r}
#| label: data-structure

# Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ù†ÙŠØ©
cat("Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", nrow(school_data), "ØµÙ Ã—", ncol(school_data), "Ø¹Ù…ÙˆØ¯\n\n")
cat("Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ÙˆØ£Ù†ÙˆØ§Ø¹Ù‡Ø§:\n")
glimpse(school_data)
```

## ÙˆØµÙ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©

| Ø§Ù„Ø¹Ù…ÙˆØ¯ | Ø§Ù„ÙˆØµÙ | Ø§Ù„Ù†ÙˆØ¹ |
|--------|-------|------|
| `school_code` | Ø§Ù„Ù…Ø¹Ø±Ù Ø§Ù„ÙØ±ÙŠØ¯ Ù„ÙƒÙ„ Ù…Ø¯Ø±Ø³Ø© | Ø±Ù‚Ù…ÙŠ |
| `school_name` | Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø© (Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©) | Ù†ØµÙŠ |
| `level_code` | Ø±Ù…Ø² Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ | Ø±Ù‚Ù…ÙŠ |
| `level_name` | Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ | Ù†ØµÙŠ |
| `nb_students` | Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† | Ø±Ù‚Ù…ÙŠ |
| `nb_passed` | Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° Ø§Ù„Ù†Ø§Ø¬Ø­ÙŠÙ† | Ø±Ù‚Ù…ÙŠ |
| `governorate` | Ø§Ø³Ù… Ø§Ù„ÙˆÙ„Ø§ÙŠØ© (Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©) | Ù†ØµÙŠ |
| `governorate_ar` | Ø§Ø³Ù… Ø§Ù„ÙˆÙ„Ø§ÙŠØ© (Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©) | Ù†ØµÙŠ |
| `success_rate` | Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ Ø§Ù„Ù…Ø¦ÙˆÙŠØ© | Ø±Ù‚Ù…ÙŠ |
| `nb_failed` | Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° Ø§Ù„Ø±Ø§Ø³Ø¨ÙŠÙ† | Ø±Ù‚Ù…ÙŠ |

## Ø¹ÙŠÙ†Ø© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

Ø¥Ù„ÙŠÙƒ Ø£ÙˆÙ„ 20 ØµÙÙ‹Ø§ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:

```{r}
#| label: sample-data

school_data %>%
  select(school_name, level_name, nb_students, nb_passed, success_rate, governorate_ar) %>%
  head(20) %>%
  kable(col.names = c("Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©", "Ø§Ù„Ù…Ø³ØªÙˆÙ‰", "Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°", "Ø§Ù„Ù†Ø§Ø¬Ø­ÙˆÙ†", "Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ %", "Ø§Ù„ÙˆÙ„Ø§ÙŠØ©")) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = TRUE)
```

## Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©

```{r}
#| label: overall-stats

cat("ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©:\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n")

total_students <- sum(school_data$nb_students, na.rm = TRUE)
total_passed <- sum(school_data$nb_passed, na.rm = TRUE)
total_failed <- sum(school_data$nb_failed, na.rm = TRUE)
overall_rate <- round(total_passed / total_students * 100, 2)

cat("ğŸ‘¥ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°:", format(total_students, big.mark = ","), "\n")
cat("âœ… Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ø§Ø¬Ø­ÙŠÙ†:", format(total_passed, big.mark = ","), "\n")
cat("âŒ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø§Ø³Ø¨ÙŠÙ†:", format(total_failed, big.mark = ","), "\n")
cat("ğŸ“ˆ Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©:", overall_rate, "%\n\n")

cat("ğŸ« Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯Ø§Ø±Ø³:", n_distinct(school_data$school_code), "\n")
cat("ğŸ—ºï¸ Ø¹Ø¯Ø¯ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª:", n_distinct(school_data$governorate), "\n")
cat("ğŸ“š Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©:", n_distinct(school_data$level_name), "\n")
```

## ØªÙˆØ²ÙŠØ¹ Ù†Ø³Ø¨ Ø§Ù„Ù†Ø¬Ø§Ø­

```{r}
#| label: success-distribution
#| fig-cap: "ØªÙˆØ²ÙŠØ¹ Ù†Ø³Ø¨ Ø§Ù„Ù†Ø¬Ø§Ø­ Ø¹Ø¨Ø± Ø§Ù„Ù…Ø¯Ø§Ø±Ø³"
#| fig-width: 12
#| fig-height: 6

ggplot(school_data, aes(x = success_rate)) +
  geom_histogram(binwidth = 5, fill = "#3498db", color = "white", alpha = 0.8) +
  geom_vline(xintercept = mean(school_data$success_rate, na.rm = TRUE), 
             color = "#e74c3c", linetype = "dashed", linewidth = 1.2) +
  labs(
    title = "ØªÙˆØ²ÙŠØ¹ Ù†Ø³Ø¨ Ø§Ù„Ù†Ø¬Ø§Ø­",
    subtitle = "Ø§Ù„Ø®Ø· Ø§Ù„Ø£Ø­Ù…Ø± ÙŠÙ…Ø«Ù„ Ø§Ù„Ù…ØªÙˆØ³Ø·",
    x = "Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ (%)",
    y = "Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯Ø§Ø±Ø³"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5, color = "#7f8c8d")
  )
```

## Ù†Ø³Ø¨ Ø§Ù„Ù†Ø¬Ø§Ø­ Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ„Ø§ÙŠØ©

```{r}
#| label: by-governorate
#| fig-cap: "Ù†Ø³Ø¨ Ø§Ù„Ù†Ø¬Ø§Ø­ Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ„Ø§ÙŠØ©"
#| fig-width: 14
#| fig-height: 10

# Ø­Ø³Ø§Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
gov_summary <- school_data %>%
  filter(!is.na(governorate_ar)) %>%
  group_by(governorate_ar) %>%
  summarise(
    n_schools = n_distinct(school_code),
    total_students = sum(nb_students),
    total_passed = sum(nb_passed),
    success_rate = round(total_passed / total_students * 100, 1),
    .groups = "drop"
  ) %>%
  arrange(desc(success_rate))

ggplot(gov_summary, aes(x = reorder(governorate_ar, success_rate), y = success_rate)) +
  geom_col(aes(fill = success_rate), show.legend = FALSE) +
  geom_text(aes(label = paste0(success_rate, "%")), hjust = -0.1, size = 4) +
  scale_fill_gradient2(low = "#e74c3c", mid = "#f39c12", high = "#27ae60", midpoint = 90) +
  coord_flip() +
  ylim(0, 100) +
  labs(
    title = "Ù†Ø³Ø¨ Ø§Ù„Ù†Ø¬Ø§Ø­ Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ„Ø§ÙŠØ©",
    x = "",
    y = "Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ (%)"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5, size = 18),
    axis.text.y = element_text(size = 11, face = "bold")
  )
```

## Ù†Ø³Ø¨ Ø§Ù„Ù†Ø¬Ø§Ø­ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ

```{r}
#| label: by-level

level_summary <- school_data %>%
  group_by(level_name) %>%
  summarise(
    total_students = sum(nb_students),
    total_passed = sum(nb_passed),
    success_rate = round(total_passed / total_students * 100, 1),
    .groups = "drop"
  ) %>%
  arrange(desc(success_rate))

level_summary %>%
  kable(col.names = c("Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ", "Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°", "Ø§Ù„Ù†Ø§Ø¬Ø­ÙˆÙ†", "Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ %")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

## Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©

```{r}
#| label: missing-values

missing_counts <- sapply(school_data, function(x) sum(is.na(x)))
missing_pct <- sapply(school_data, function(x) round(sum(is.na(x)) / length(x) * 100, 2))

missing_summary <- data.frame(
  column = names(school_data),
  missing = missing_counts,
  pct = missing_pct
)

missing_summary %>%
  filter(missing > 0) %>%
  kable(col.names = c("Ø§Ù„Ø¹Ù…ÙˆØ¯", "Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©", "Ø§Ù„Ù†Ø³Ø¨Ø© %")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)

if(sum(missing_counts) == 0) {
  cat("âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ÙŠÙ… Ù…ÙÙ‚ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!")
}
```
